<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="大数据实践-01阿里-数据模型, 戚中一">
    <meta name="description" content="写在前面：本文主要记录大数据实践-01阿里-数据模型的相关内容


1. 建模综述数据模型：是数据组织和存储方法，强调从业务、数据存取和使用角度合理存储数据

性能：良好的数据模型能帮助我们快速查询所需要的数据，减少数据的 I/O 吞吐成本">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>大数据实践-01阿里-数据模型 | 戚中一</title>
    <link rel="icon" type="image/jpeg" href="/logo.jpg">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.2"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/logo.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">戚中一</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/logo.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">戚中一</div>
        <div class="logo-desc">
            
            戚中一
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="ttps://github.com/qizhongyizhang" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="ttps://github.com/qizhongyizhang" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/6.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">大数据实践-01阿里-数据模型</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">
                                <span class="chip bg-color">大数据</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%AE%9E%E8%B7%B5/" class="post-category">
                                实践
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-09-02
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-10-17
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    14.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    49 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>写在前面：本文主要记录大数据实践-01阿里-数据模型的相关内容</p>
<span id="more"></span>

<h1 id="1-建模综述"><a href="#1-建模综述" class="headerlink" title="1. 建模综述"></a>1. 建模综述</h1><p><strong>数据模型</strong>：是数据组织和存储方法，强调从业务、数据存取和使用角度合理存储数据</p>
<blockquote>
<p>性能：良好的数据模型能帮助我们快速查询所需要的数据，减少数据的 I/O 吞吐<br>成本：良好的数据模型能极大地减少不必要的数据冗余，也能实现计算结果复用，极大地降低大数据系统中的存储和计算成本<br>效率：良好的数据模型能极大地改善用户使用数据的体验，提高使用数据的效率<br>质量：良好的数据模型能改善数据统计口径的不一致性，减少数据计算错误的可能性</p>
</blockquote>
<h2 id="1-1-数据仓库建模"><a href="#1-1-数据仓库建模" class="headerlink" title="1.1 数据仓库建模"></a>1.1 数据仓库建模</h2><ul>
<li><strong>ER 模型</strong>：从全企业的高度设计一个3NF 模型，用实体关系（ Entity Relationship, ER ）模型描述企业业务，在范式理论上符合 3NF；将各个系统中的数据以整个企业角度按主题进行相似性组合和合并，并进行一致性处理，为数据分析决策服务；FS-LDM (Financial Services Logical Data Model ）</li>
</ul>
<blockquote>
<p>高层模型：一个高度抽象的模型，描述主要的主题以及主题间的关系，用于描述企业的业务总体概况<br>中层模型：在高层模型的基础上，细化主题的数据项<br>物理模型：也叫底层模型，在中层模型的基础上，考虑物理存储，同时基于性能和平台特点进行物理属性做一些表的合并、分区的设计等</p>
</blockquote>
<ul>
<li><strong>维度模型</strong>：从分析决策的需求出发构建模型，为分析需求服务；如，星形模型、雪花模型等</li>
</ul>
<blockquote>
<ol>
<li>选择需要进行分析决策的业务过程：业务过程可以是单个业务事件，比如交易的支付、退款等；也可以是某个事件的状态，比如当前的账户余额等；还可以是一系列相关业务事件组成的业务流程，具体需要看我们分析的是某些事件发生情况，还是当前状态，或是事件流转效率</li>
<li>选择粒度：在事件分析中，我们要预判所有分析需要细分的程度，从而决定选择的粒度；粒度是维度的一个组合</li>
<li>识别维表：选择好粒度之后，基于此粒度设计维表，包括维度属性，用于分析时进行分组和筛选</li>
<li>选择事实：确定分析需要衡量的指标</li>
</ol>
</blockquote>
<ul>
<li><strong>Data Vault 模型</strong>：是 ER模型的衍生，建立一个可审计的基础数据层强调数据的历史性、可追溯性和原子性</li>
</ul>
<blockquote>
<p><img src="https://qizhongyi.gitee.io/images/Data/DataManage/Ali_Practice/0201_DataValut%E6%A8%A1%E5%9E%8B.png" alt="0201_DataValut模型"><br>Hub ：是企业的核心业务实体，由 实体 key 、数据仓库序列代理键、装载时间、数据来源组成<br>Link ：代表 Hub 之间的关系，与 ER 模型最大的区别是将关系作为一个独立的单元抽象，可以提升模型的扩展性；可以直接描述1：1、1：n、 n：n 关系，不需要做任何变更；由 Hub的代理键、装载时间、数据来源组成<br>Satellite ：是 Hub 的详细描述内容， 一个 Hub 可以有多个 Satellite；由 Hub 的代理键、装载时间、来源类型、详细的 Hub 描述信息组成</p>
</blockquote>
<ul>
<li><strong>Anchor 模型</strong>：对 Data Vault 模型的进一步规范化处理，核心思想是所有的扩展只是添加而不是修改</li>
</ul>
<blockquote>
<p><img src="https://qizhongyi.gitee.io/images//Data/DataManage/Ali_Practice/0202_Anchor%E6%A8%A1%E5%9E%8B.png" alt="0202_Anchor模型"><br>Anchors ：类似于 Data Vault 的 Hub ，代表业务实体，且只有主键<br>Attributes ：类似于 Data Vault 的 Satellite ，更加规范化，将其全部 k-v 结构化， 一个表只有一个 Anchors 的属性描述<br>Ties ：描述 Anchors 之间的关系，单独用表来描述，类似于 Data Vault 的 Link ，可以提升整体模型关系的扩展能力<br>Knots ：代表可能会在多个 Anchors 中公用的属性的提炼，比如性别、状态等这种枚举类型且被公用的属性</p>
</blockquote>
<h3 id="1-1-1-数据仓库建模过程"><a href="#1-1-1-数据仓库建模过程" class="headerlink" title="1.1.1 数据仓库建模过程"></a>1.1.1 数据仓库建模过程</h3><ul>
<li><strong>第一阶段</strong>：完全应用驱动的时代，阿里巴巴的第一代数据仓库系统构建在 Oracle 上，数据完全以满足报表需求为目的，将数据以与源结构相同的方式同步到 Oracle （称作 ODS 层），数据工程师基于 ODS 数据进行统计，基本没有系统化的模型方法体系，完全基于对 Oracle数据库特性的利用进行数据存储和加工，部分采用 一些维度建模的缓慢化维方式进行历史数据处理；数据架构只有 ODS+DSS 两层</li>
<li><strong>第二阶段</strong>：引入 MPP 架构体系的 Greenplum，同时阿里巴巴的数据团队也在进行一定的数据架构优化，改变烟囱式的开发模型 ，消除冗余 ，提升数据的一致性；采用工程领域比较流行的 ER模型＋维度模型方式，构建出一个四层的模型架构，ODL ：操作数据层 +BDL ：基础数据层 +IDL ：接口数据层 +ADL ：应用数据层； ODL 和源系统保持一致；BDL 引入 ER模型，加强数据整合，构建一致的基础数据模型；IDL 基于维度模型方法构建集市层；ADL 完成应用的个性化和基于展现需求的数据组装；迟迟未能产出</li>
<li><strong>第三阶段</strong>：以 Hadoop 为代表的分布式存储计算平台结合集团自主研发的分布式计算平台 MaxCompute ；选择以 Kimball 的维度建模为核心理念的模型方法论，对其进行一定的升级和扩展，构建阿里巴巴集团的公共层模型数据架构体系，着力解决数据存储和计算的共享问题；形成是一套统一化的集团数据整合及管理的方法体系（内部称为“OneData ”），包括一致性的指标定义体系 、模型设计方法体系以及配套工具</li>
</ul>
<h1 id="2-OneData"><a href="#2-OneData" class="headerlink" title="2. OneData"></a>2. OneData</h1><p><strong>OneData</strong>：是阿里巴巴内部进行数据整合及管理的方法体系和工具；建设统一的、规范化的数据接入层（ ODS ）和数据中间层（ DWD 和 DWS ），通过数据服务和数据产品，完成服务于阿里巴巴的大数据系统的数据公共层建设；提供标准化的（ Standard ）、共享的（ Shared ）、数据服务（ Service ）能力，降低数据互通成本，释放计算、存储、人力等资源，以消除业务和技术之痛</p>
<p><strong>OneData体系架构</strong></p>
<blockquote>
<p><img src="https://qizhongyi.gitee.io/images/Data/DataManage/Ali_Practice/0203_OneData%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84.png" alt="0203_OneData体系架构"><br>业务板块：阿里巴巴集团业务生态庞大，根据业务的属性划分出几个相对独立的业务板块，业务板块之间的指标或业务重叠性较小；如电商业务板块涵盖淘系、 B2B系和 AliExp ess 系等<br>规范定义： 以维度建模作为理论基础构建总线矩阵，划分和定义数据域、业务过程、维度、度量/原子指标、修饰类型、修饰词、时间周期、派生指标<br>模型设计： 以维度建模理论为基础，基于维度建模总线架构，构建一致、规范定义的维度和事实；在落地表模型时，基于阿里自身业务特点，设计出一套表规范命名体系</p>
</blockquote>
<h2 id="2-1-规范定义"><a href="#2-1-规范定义" class="headerlink" title="2.1 规范定义"></a>2.1 规范定义</h2><ul>
<li><strong>规范定义实例</strong><br><img src="https://qizhongyi.gitee.io/images/Data/DataManage/Ali_Practice/0204_OneData%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84_%E8%A7%84%E8%8C%83%E5%AE%9A%E4%B9%89.png" alt="0204_OneData体系架构_规范定义"></li>
<li><strong>名词解释</strong></li>
</ul>
<blockquote>
<p>度量/原子指标：基于某一业务行为下的度量，是业务定义中不可再拆分的指标<br>派生指标：由一个原子指标＋多个修饰词（可选）＋时间周期组成，对原子指标业务统计范罔的圈定；如原子指标：支付金额；派生指标：最近1天海外买家支付金额<br>维度：维度是度量的环境，用来反映业务的一类属性，如地理维度（其中包挤罔家、地区、省以及城市等级别的内容）、时间维度（其中包括年、季、月、周、日等级别的内容）<br>维度属性：维度属性隶属于一个维度，如地理维度里面的国家名称、同家 ID 、省份名称等</p>
</blockquote>
<ul>
<li><strong>指标体系</strong><br><strong>基本原则</strong></li>
</ul>
<blockquote>
<p>组成体系之间的关系</p>
<blockquote>
<p>派生指标由原子指标、时间周期修饰词、若干其他修饰词组合得到<br>原子指标、修饰类型及修饰词，直接归属在业务过程下，修饰词继承修饰类型的数据域<br>派生指标可以选择多个修饰词，修饰词之间的关系为“或”或“且”，由具体的派生指标语义决定<br>派生指标唯一归属一个原子指标 ，继承原子指标的数据域，与修饰词的数据域无关</p>
</blockquote>
<p>命名约定</p>
<blockquote>
<p>命名所用术语：指标命名，尽量使用英文简写，其次是英文，指标英文名太长时，可考虑用汉语拼音首字母命名；如中国制造用 zgzz<br>业务过程：英文名：用英文或英文的缩写或者中文拼音简写；中文名：具体的业务过程中文<br>原子指标：英文名 ：动作＋度量：中文名：动作＋度量<br>修饰词：只有时间周期才会有英文名，且长度为2位，加上“_”共三位，如 _id<br>派生指标：英文名：原子指标英文名＋时间周期修饰词（3 位，如_Id) ＋序号（ 4位，如_001 ）；中文名：时间周期修饰词＋［其他修饰词］＋原子指标</p>
</blockquote>
<p>算法</p>
<blockquote>
<p>算法概述一一算法对应的用户容易理解的阐述<br>举例一一通过具体例子帮助理解指标算法<br>SQL 算法说明一一对于派生指标给出 SQL 的写法或者伪代码</p>
</blockquote>
</blockquote>
<p><strong>操作细则</strong></p>
<blockquote>
<p>派生指标的种类</p>
<blockquote>
<p>事务型指标：是指对业务活动进行衡量的指标；如新发商品数、重发商品数、新增注册会员数、订单支付金额，这类指标需维护原子指标及修饰词，在此基础上创建派生指标<br>存量型指标：是指对实体对象（如商品、会员）某些状态的统计；例如商品总数、注册会员总数，这类指标需维护原子指标及修饰词，在此基础上创建派生指标，对应的时间周期 般为“历史截至当前某个时间”<br>复合型指标：是在事务型指标和存量型指标的基础上复合而成；如浏览 UV－下单买家数转化率 有些需要 建新原子指标，有些则可以在事务型或存量型原子指标的基础上增加修饰词得到派生指标</p>
</blockquote>
<p>复合型指标的规则</p>
<blockquote>
<p>比率型：创建原子指标，如 TR 、浏览 UV 下单买家数转化率、满意率等；如“最近1天店铺首页 CTR”，原子指标为“ CTR ”<br>比例型 创建原子指标，如百分比 、占 比；如“最近1天无线支付金额占比”，原子指标为“支付金额占比”<br>变化量型：不创建原子指标，增加修饰词，在此基础上创建派指标；如，“最近1天订单支付金额上的变化量”，原子指标为“订单支付金额”<br>变化率型：创建原子指标。例如，“最近7天海外买家支付金额变化率”，原子指标为“支付金额变化率”<br>统计型：不创建原子指标，增加修饰词，在此基础上创建派生指标；在修饰类型 “统计方法”下增加修饰词，如人均、日均、行业平均、商品平均 90 分位数 70 分位数等；如，“自然月日均 UV”，原子指标为“UV”<br>排名型：创建原子指标， 一般为 top_xxx xxx，或rank 和 top_xxx_xxx 组合；修饰词可以有：统计方法（如降序、升序）、排名名次（如 TOP IO ）、排名范围（如行业、省份、一级来源等）、排序因子（如搜索次数、 PV ）等<br>对象集合型：主要是指数据产品和应用需要展现数据时，将一些对象以 k-v 对的方式存储在一个字段 中；如趋势图、 TOP 排名对象等</p>
</blockquote>
</blockquote>
<p><strong>其他规则</strong></p>
<blockquote>
<p>上下层级派生指标同时存在时：如最近 天支付金额和最近 PC 端支付金额，建议使用前者，PC 端作为维度属性存放在物理表中体现<br>父子关系原子指标存在时：优先选择子原子指标；使用子原子指标创建派生指标</p>
</blockquote>
<h2 id="2-2-模型设计"><a href="#2-2-模型设计" class="headerlink" title="2.2 模型设计"></a>2.2 模型设计</h2><ul>
<li><strong>模型设计架构</strong><br><img src="https://qizhongyi.gitee.io/images/Data/DataManage/Ali_Practice/0205_OneData%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84_%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%9E%B6%E6%9E%84.png" alt="0205_OneData体系架构_模型设计架构"></li>
<li><strong>模型层次</strong>：操作数据层（ ODS ）、公共维度模型层（ CDM ）和应用数据层（ ADS ），其中公共维度模型层包括明细数据层（ DWD ）和汇总数据层（ DWS ）<br><strong>操作数据层（ ODS ）</strong>：把操作系统数据无处理地存放在数据仓库系统中</li>
</ul>
<blockquote>
<p>同步：结构化数据增量或全量同步到 MaxCompute<br>结构化：非结构化（日志）结构化处理并存储至lj MaxCompt闹<br>累积历史、清洗：根据数据业务需求及稽核和审计要求保存历史数据、清洗数据</p>
</blockquote>
<p><strong>公共维度模型层（ CDM ）</strong>：存放明细事实数据、维表数据及公共指标汇总数据，其中明细事实数据、维表数据根据 ODS 层数据加工生成；公共指标汇总数据根据维表数据和明细事实数据加工生成</p>
<blockquote>
<p>组合相关和相似数据：采用明细宽表，复用关联计算，减少数据扫描<br>公共指标统 加工：基于 OneData 体系构建命名规范、口径一致和算法统一的统计指标，为上层数据产品、应用和服务提供公共指标，建立逻辑汇总宽表<br>建立 致性维度：建立一致的数据分析维表，降低数据计算口径、算法不统一的风险</p>
</blockquote>
<p><strong>应用数据层（ ADS ）</strong>：存放数据产品个性化的统计指标数据，根据CDM 层与 ODS 层加工生成</p>
<blockquote>
<p>个性化指标加工：不公用性、复杂性（指数型、比值型、排名型指标）<br>基于应用的数据组装 大宽表集市、横表转纵表、趋势指标串</p>
</blockquote>
<ul>
<li><strong>基本原则</strong></li>
</ul>
<ol>
<li>高内聚和低耦合：将高概率同 时访问的数据放一起，将低概率同时访问的数据分开存储</li>
<li>核心模型与扩展模型分离：核心模型包括的宇段支持常用的核心业务，扩展模型包括的字段支持个性化或少量应用的需要 ，不能让扩展模型的宇段过度侵入核心模型</li>
<li>公共处理逻辑下沉及单一：不要让公用的处理逻辑暴露给应用层实现，不要让公共逻辑多处同时存在</li>
<li>成本与性能平衡：适当的数据冗余可换取查询和刷新性能，不宜过度冗余</li>
<li>数据可回滚：处理逻辑不变，在不同时间多次运行数据结果确定不变</li>
<li>一致性：具有相同含义的字段在不同表中的命名必须相同，使用规范定义</li>
<li>命名清晰、可理：表命名需清晰、一致，表名需易于消费者理解和使用</li>
</ol>
<h2 id="2-3-实现"><a href="#2-3-实现" class="headerlink" title="2.3 实现"></a>2.3 实现</h2><ul>
<li><p><strong>指导方针</strong>：进行充分的业务调研和需求分析；进行数据总体架构设计，根据数据域对数据进行划分，按照维度建模理论，构建总线矩阵、抽象出业务过程和维度；对报表需求进行抽象整理出相关指标体系，使用 OneData 工具完成指标规范定义和模型设计；代码研发和运维</p>
</li>
<li><p><strong>实施工作流</strong></p>
<ol>
<li><strong>数据调研</strong><br>业务调研：阿里集团涉及的业务涵盖电商、数 娱乐、导航（高德）、移动互联网服务等领域，细分业务领域、业务线、业务模块和业务流程<br>需求调研：收集数据使用者的需求，如了解分析师、业务运营人员的数据诉求，形成报表需求</li>
</ol>
<blockquote>
<p>与分析师、业务运营人员的沟通（邮件、 IM ）获知需求<br>对报表系统中现有的报表进行研究分析</p>
</blockquote>
<ol start="2">
<li><strong>架构设计</strong><br>数据域划分：数据域是指面向业务分析，将业务过程或者维度进行抽象的集合；数据域需要抽象提炼，长期维护和更新，谨慎变动<br>构建总线矩阵：明确每个数据域下的业务过程，业务过程与维度关联性；定义每个数据域下的业务过程和维度</li>
<li><strong>规范定义</strong>：规范定义主要定义指标体系，包括原子指标、修饰词、时间周期和派生指标</li>
<li><strong>模型设计</strong>：模型设计主要包括维度及属性的规范定义，维表、明细事实表和汇总事实表的模型设计</li>
<li><strong>总结</strong>：实施过程是一个高度迭代和动态的过程，一般采用螺旋式实施方法；在总体架构设计完成之后，开始根据数据域进行迭代式模型设计和评审</li>
</ol>
</li>
</ul>
<h1 id="3-维度设计"><a href="#3-维度设计" class="headerlink" title="3. 维度设计"></a>3. 维度设计</h1><p><strong>维度</strong>：将度量称为“事实”，环境描述为“维度”；维度是用于分析事实所需要的多样环境；维度使用代理主键或自然主键标识其唯一性，代理键是不具有业务含义的键，用于处理缓慢变化维；自然键是具有业务含义的键<br><strong>维度属性</strong>：维度所包含的表示维度的列；是查询约束条件、分组和报表标签生成的基本来源，是数据易用性的关键</p>
<h2 id="3-1-设计方法"><a href="#3-1-设计方法" class="headerlink" title="3.1 设计方法"></a>3.1 设计方法</h2><ol>
<li>选择维度或新建维度；作为维度建模的核心，在企业级数据仓库中必须保证维度的唯一性；如淘宝商品维度有且只允许有一个维度定义</li>
<li>确定主维表；主维表一般是 ODS 表，直接与业务系统同步；如淘宝商品维度， s_auction_auctions 是与前台商品中心系统同步的商品表是主维表</li>
<li>确定相关维表；确定和主维表存在关联关系的表，并结合业务生成维度属性；如淘宝商品维度与类目、 SPU 卖家、店铺等维度存在关联关系</li>
<li>确定维度属性；先从主维表中选择维度属性或生成新的维度属性，再从相关维表中选择维度属性或生成新的维度属性；如淘宝商品维度的主维表 s_auction_auctions 和类目、 SPU 、卖家、店铺等相关维表中选择维度属性或生成新的维度属性</li>
</ol>
<blockquote>
<p>尽可能生成丰富的维度属性：为下游的数据统计、分析、探查提供良好基础<br>尽可能多地给出包括一些富有意义的文字性描述：一般是编码和文字同时存在，编码用于表间关联，名称用于报表标签<br>区分数值型属性和事实：若通常用于查询约束条件或分组统计，则作为维度属性；若通常用于参与度量的计算，则作为事实<br>尽量沉淀出通用的维度属性：可以提高下游使用的方便性，减少复杂度；可以避免下游使用解析时由于各自逻辑不同而导致口径不一致</p>
</blockquote>
<h3 id="3-1-1-注意问题"><a href="#3-1-1-注意问题" class="headerlink" title="3.1.1 注意问题"></a>3.1.1 注意问题</h3><p><strong>层次结构</strong>：维度中的一些描述属性以层次方式或一对多的方式相互关联，可以被理解为包含连续主从关系的属性层次<br><strong>反规范化</strong>：将维度的属性层次合并到单个维度中的操作称为反规范化，评估规范化和易用效能之间的平衡<br><strong>交叉探查</strong>：将不同数据域的商品的事实合并在一起进行数据探查称为交叉探查，如计算转化率等<br><strong>一致性表现</strong></p>
<blockquote>
<p>共享维表：如在阿里巴巴的数据仓库中，商品、卖家、买家、类目等维度有且只有一个，可以进行交叉探查<br>一致性上卷：其中一个维度的维度属性是另 一个维度的维度属性的子集，且两个维度的公共维度属性结构和内容相同；如在阿里巴巴的商品体系中，有商品维度和类目维度，其中类目维度的维度属性是商品维度的维度属性的子集，且有相同的维度属性和维度属性值，可以进行交叉探查<br>交叉属性：两个维度具有部分相同的维度属性；如在商品维度中具有类目属性，在卖家维度中具有主营类目属性，两个维度具有相同的类目属性，则可以在相同的类目属性上进行不同业务过程的交叉探查</p>
</blockquote>
<h2 id="3-2-高级主题"><a href="#3-2-高级主题" class="headerlink" title="3.2 高级主题"></a>3.2 高级主题</h2><h3 id="3-2-1-维度整合"><a href="#3-2-1-维度整合" class="headerlink" title="3.2.1 维度整合"></a>3.2.1 维度整合</h3><ul>
<li><strong>整合方式</strong></li>
</ul>
<blockquote>
<p>垂直整合：不同的来源表包含相同的数据集，只是存储的信息不同；如淘宝会员中的会员基础信息表、会员扩展信息表、淘宝会员等级信息表和天猫会员等级信息表，可以整合至会员维度模型中，丰富其维度属性<br>水平整合：不同的来源表包含不同的数据集，不同子集之间存在部分交叉或不交叉，如蚂蚁金服有淘宝会员、 1688 会员、国际站会员、支付宝会员等</p>
</blockquote>
<h4 id="3-2-1-1-数据仓库集成"><a href="#3-2-1-1-数据仓库集成" class="headerlink" title="3.2.1.1 数据仓库集成"></a>3.2.1.1 数据仓库集成</h4><p><strong>应用差异</strong></p>
<blockquote>
<p>数据存储方式不同；关系型数据库存储（Oracle、 MySQL ）、NoSQL 数据库存储（ HBase、 Tair ）或文件存储（Excel、HDFS）<br>在编码、命名习惯、度量单位等方面会存在很大的差异；如对于用户的性别编码不同，有 0和1 、或 F和M</p>
</blockquote>
<p><strong>集成表现</strong></p>
<blockquote>
<p>命名规范的统一：表名、字段名等统一<br>字段类型的统一：相同和相似字段的字段类型统一<br>数据代码的统一：公共代码、标志性宇段的数据类型、命名方式等统一<br>业务表的统一：依据高内聚、低稠合的理念，将业务关系大、业务含义相同、源系统影响差异小的表整合；将业务关系小、源系统影响差异大的表分而置之</p>
</blockquote>
<p><strong>集成方式</strong></p>
<blockquote>
<p>采用主从表的设计方式，将两个表或多个表都有的字段放在主表中（主要基本信息），从属信息分别放在各自的从表中；对于主表中的主键，采用复合主键、源主键和系统或表区别标志；或者采用唯一主键、“源主键和系统或表区别标志”生成新的主键；建议采用复合主键<br>直接合并，共有信息和个性信息都放在同一个表中；可能由于表字段的重合度较低出现大量空值，影响存储和易用性<br>不合并源表的表结构及主键等差异很大的业务表，使用数据仓库存放各自的数据</p>
</blockquote>
<h3 id="3-2-1-2-维度拆分"><a href="#3-2-1-2-维度拆分" class="headerlink" title="3.2.1.2 维度拆分"></a>3.2.1.2 维度拆分</h3><p><strong>拆分原则</strong></p>
<blockquote>
<p>扩展性：当源系统、业务逻辑变化时，能通过较少的成本快速扩展模型，保持核心模型的相对稳定性；保障高内聚、低稠合<br>效能：在性能和成本方面取得平衡；通过牺牲一定的存储成本，达到性能和逻辑的优化<br>易用性：模型可理解性高、访问复杂度低；用户能够方便地从模型中找到对应的数据表，并能够方便地查询和分析</p>
</blockquote>
<ul>
<li><strong>水平拆分情况</strong></li>
</ul>
<blockquote>
<p>维度的不同分类的属性差异情况：维度属性随类型变化较大<br>业务的关联程度：拆分相关性较低的业务</p>
</blockquote>
<ul>
<li><strong>垂直拆分情况</strong></li>
</ul>
<blockquote>
<p>某些维度属性的来源表产出时间较早，某些维度属性的来表产出时间较晚<br>某些维度属性的热度高、使用频繁，某些维度属性的热度低、较少使用<br>某些维度属性经常变化，某些维度属性比较稳定</p>
</blockquote>
<p><strong>解决方案</strong>：出于扩展性、产出时间、易用性等方面的考虑，设计主从维度；主维表存放稳定 产出时间早、热度高的属性；从维表存放变化较快、产出时间晚、热度低的属性</p>
<h3 id="3-2-2-历史归档"><a href="#3-2-2-历史归档" class="headerlink" title="3.2.2 历史归档"></a>3.2.2 历史归档</h3><blockquote>
<p>归档策略1：同前台归档策略，在数据仓库中实现前台归档算法，定期对历史数据进行归档；存在问题：前台归档策略复杂，实现成本较高；前台归档策略可能会经常变化，导致数据仓库归档算法也要随之变化，维护和沟通成本较高；适用于前台归档策略逻辑较为简单，且变更不频繁的情况<br>归档策略2：同前台归档策略，采用数据库变更日志的方式；通过数据库 binlog 日志解析获取每日增量，通过增量 merge 全量的方式获取最新的全量数据；使用增量日志的删除标志，作为前台数据归档的标志，通过此标志对数据仓库的数据进行归档；此方式不关注前台归档策略，简单易行；但对前台应用的要求是数据库的物理删除只有在归档时才执行，应用中的删除只是逻辑删除<br>归档策略3：数据仓库自定义归档策略；将归档算法用简单、直接的方式实现，遵循尽量比前台应用晚归档、少归档的原则；避免出现数据仓库中已经归档的数据再次更新的情况</p>
</blockquote>
<h2 id="3-3-维度变化"><a href="#3-3-维度变化" class="headerlink" title="3.3 维度变化"></a>3.3 维度变化</h2><h3 id="3-3-1-缓慢变化维"><a href="#3-3-1-缓慢变化维" class="headerlink" title="3.3.1 缓慢变化维"></a>3.3.1 缓慢变化维</h3><blockquote>
<p>重写维度值：不保留历史数据，始终取最新数据<br>插人新的维度行：保留历史数据，维度值变化前的事实和过去的维度值关联，维度值变化后的事实和当前的维度值关联<br>添加维度列：将变化前后记录的事实归一为变化前的维度或变化后的维度</p>
</blockquote>
<h3 id="3-3-2-快照维表"><a href="#3-3-2-快照维表" class="headerlink" title="3.3.2 快照维表"></a>3.3.2 快照维表</h3><p><strong>快照维表</strong>：处理缓慢变化维的问题，采用快照方式周期性（每天）保留一份全量数据；造成大量存储浪费</p>
<blockquote>
<p>简单而有效，开发和维护成本低<br>使用方便，理解性好；数据使用方只需要限定日期，即可获取到当天的快照数据，任意一天的事实快照和维度快照通过维度的自然键进行关联</p>
</blockquote>
<h3 id="3-3-3-极限存储"><a href="#3-3-3-极限存储" class="headerlink" title="3.3.3 极限存储"></a>3.3.3 极限存储</h3><p><strong>历史拉链存储</strong>：利用维度模型处理缓慢变化维；新增两个时间戳字段（start_dt 和 end_dt ），将所有以天为粒度的变更数据都记录下来；时间戳字段也用作分区，随着时间推移，分区数量会极度膨胀，受到现行数据库分区数量的限制</p>
<blockquote>
<p><strong>透明化</strong>：底层用历史拉链存储，上层增加视图或在 Hive 里增加一个 hook，通过语法分析树，把对极限存储前表的查询转换成对极限存储表的查询；对下游用户，极限存储表和全量存储一致</p>
<pre class="line-numbers language-none"><code class="language-none">select id from A where ds &#x3D; 20210101;
等价于
select id from A_EXST where start_dt &lt;&#x3D; 20210101 and end_dt &gt; 20210101;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>分月做历史拉链表</strong></p>
</blockquote>
<p><strong>优缺点</strong></p>
<blockquote>
<p>极大压缩了全量存储的成本<br>对下游用户透明<br>产出效率很低，大部分极限存储通常需要 t-2<br>对于变化频率高的数据并不能达到节约成本的效果</p>
</blockquote>
<h4 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h4><p>基于极限存储进行额外处理</p>
<blockquote>
<p>在极限存储前进行一次全量存储 ，全量存储表仅保留最近一段时间的全量分区数据，历史数据通过映射的方式关联到极限存储表；用户只访问全量存储表，极限存储对用户透明<br>对于部分变化频率频繁的宇段过滤，节约存储成本；如用户表中存在用户积分宇段</p>
</blockquote>
<h3 id="3-3-4-微型维度"><a href="#3-3-4-微型维度" class="headerlink" title="3.3.4 微型维度"></a>3.3.4 微型维度</h3><p><strong>微型维度</strong>：将一部分不稳定的属性从主维度中移出，放置到拥有自己代理键的新表中实现；属性相互之间没有直接关联，不存在自然键；通过为每个组合创建新行的一次性过程来加载数据</p>
<blockquote>
<p>微型维度的局限性；微型维度是事先用所有可能值的组合加载，需要考虑每个属性的基数，且必须是枚举值<br>ETL 逻辑复杂；对于分布式系统，生成代理键和使用代理键进行ETL 加工都非常复杂， ETL 开发和维护成本过高<br>破坏维度的可浏览性；买家维度和微型维度通过事实表建立联系，无法基于 VIP 等级、信用等级进行浏览和统计；可以通过在买家维度中添加引用微型维度的外键部分来解决，但会带来微型维度未维护历史信息的新问题</p>
</blockquote>
<h2 id="3-5-特殊维度"><a href="#3-5-特殊维度" class="headerlink" title="3.5 特殊维度"></a>3.5 特殊维度</h2><h3 id="3-5-1-递归层次"><a href="#3-5-1-递归层次" class="headerlink" title="3.5.1 递归层次"></a>3.5.1 递归层次</h3><p><strong>递归层次</strong>：指的是某维度的实例值的层次关系；按照层级是否固定分为均衡层次结构和非均衡层次结构；均衡层次结构如类目：叶子类目、五级类 目、四级类目、三级类目、二级类目、一级类曰；地区：乡镇／街道、区县、城市、省份、国家；非均衡层次结构如公司：可能存在一个母公司</p>
<blockquote>
<p><strong>层次结构扁平化</strong>：通过建立每个维度层级属性字段实现，可以在一定程度上解决上钻和下钻问题，适用于均衡层次结构，对于非平衡层次结构，可以通过预留级别的方式来解决</p>
<blockquote>
<p>针对某类目上钻或下钻之前，必须知道其所属的类目层级，然后才能决定限制哪一级类目<br>由于某些叶子类目直接是一级类目或二级类目，造成查询问题；解决此类目对应的三级类目为空 ，则取二=级类目：如果二级类目仍为空，则取一级类目</p>
</blockquote>
<p><strong>层次桥接表</strong>：不需要预先知道所属层级，不需要回填，也可解决非均衡层次结构问题；法适合解决更宽泛的分析问题，灵活性好；但复杂性高，使用成本高</p>
<blockquote>
<p>桥接表包括父级类目ID、子级类目ID和类目层级间隔三个字段，枚举出所有关联类目之间的关系</p>
</blockquote>
</blockquote>
<h3 id="3-5-2-行为维度"><a href="#3-5-2-行为维度" class="headerlink" title="3.5.2 行为维度"></a>3.5.2 行为维度</h3><p><strong>行为维度</strong>：与事实相关的维度，如交易、物流等</p>
<blockquote>
<p>另一个维度的过去行为；如买家最近一次访问淘宝的时间、 买家最近一次发生淘宝交易的时间等<br>快照事实行为维度；如买家从年初截至当前的淘宝交易金额、买家信用分值 、卖家信用分值等<br>分组事实行为维度，将数值型事实转换为枚举值；如买家从年初截至当前的淘宝交易金额按照金额划分的等级 买家信用分值按照分数划分得到的信用等级等<br>复杂逻辑事实行为维度，通过复杂算法加工或多个事实综合加工得到；如卖家主营类目，商品热度根据访问、收藏、加人购物车、交易等情况综合计算得到</p>
</blockquote>
<ul>
<li><strong>处理方式</strong></li>
</ul>
<blockquote>
<p>将其冗余至现有的维表中；如将卖家信用等级冗余至卖家维表中<br>加工成单独的行为维表；如卖家主营类目</p>
</blockquote>
<ul>
<li><strong>处理原则</strong></li>
</ul>
<blockquote>
<p>避免维度过快增长<br>避免稠合度过高</p>
</blockquote>
<h3 id="3-5-3-多值维度"><a href="#3-5-3-多值维度" class="headerlink" title="3.5.3 多值维度"></a>3.5.3 多值维度</h3><p><strong>多值维度</strong>：事实表的一条记录在某维表中有多条子记录与之对应；如淘宝交易订单，买家一次购买了多种商品</p>
<ul>
<li><strong>处理方式</strong></li>
</ul>
<blockquote>
<p>降低事实表的粒度：将交易订单设计为子订单粒度，对于每个子订单，只有 种商品与之对应；前台业务和商业智能关注交易子订单<br>采用多字段：通过预留宇段的方式存储每一个子项数据，适用于子项不多，如房地产销售中，合同存在多个买受方（夫妻合买）<br>采用较为通用的桥接表：在事实表和维表之间开发一个分组桥接表，通过桥接表建立连接，桥接表包含和事实表关联的分组 KEY和维表外键；桥接表方式更加灵活、扩展性更好，但逻辑复杂、开发和维护成本较高，可能带来双重计算的风险</p>
</blockquote>
<h3 id="3-5-4-多值属性"><a href="#3-5-4-多值属性" class="headerlink" title="3.5.4 多值属性"></a>3.5.4 多值属性</h3><p><strong>多值属性</strong>：维表中的某个属性字段同时有多个值，是多值维度的另一种表现形式</p>
<ul>
<li><strong>处理方式</strong></li>
</ul>
<blockquote>
<p>保持维度主键不变，将多值属性放在维度的一个属性字段中<br>保持维度主键不变，将多值属性放在维度的多个属性字段中<br>维度主键发生变化，一个维度值存放多条记录</p>
</blockquote>
<h3 id="3-5-5-杂项维度"><a href="#3-5-5-杂项维度" class="headerlink" title="3.5.5 杂项维度"></a>3.5.5 杂项维度</h3><p><strong>杂项维度</strong>：是由操作型系统中的指示符或者标志宇段组合而成的，一般不在一致性维度之列；如淘宝交易订单的交易类型包括话费充值、司法拍卖、航旅等；支付状态、物流状态等在源系统中直接保存在交易表中；</p>
<ul>
<li><strong>存在问题</strong>：如果作为事实存放在事实表中，会导致事实表占用空间过大；如果单独建立维表，外键关联到事实表，会出现维度过多的情况；如果将这些字段删除，则会结构不统一；ETL 过程比一般维度略微复杂</li>
<li><strong>处理方式</strong>：建立杂项维度 ，将字段建立到一个维表中，在事实表中只保存一个外键；多个字段的不同取值组成一条记录，生成代理键，存人维表中，并将该代理键保存到相应的事实表字段下；建议不要直接使用所有的组合生成完整的杂项维表，在抽取遇到新的组合时生成相应的记录即可；对于非枚举字段如交易留言、交易属性（由若干k-v 对组成）、交易标签（由二进制位表示），使用实体的主键作为杂项维度的主键</li>
</ul>
<h1 id="4-事实表设计"><a href="#4-事实表设计" class="headerlink" title="4. 事实表设计"></a>4. 事实表设计</h1><h2 id="4-1-事实表基础"><a href="#4-1-事实表基础" class="headerlink" title="4.1 事实表基础"></a>4.1 事实表基础</h2><p><strong>事实表</strong>：是数据仓库维度建模的核心，围绕业务过程进行设计，通过获取描述业务过程的度量来表达业务过程，包括引用的维度和与业务过程有关的度量；作为度量业务过程的事实，一般为整型或浮点型的十进制数值，分为可加性、半可加性和不可加性三种；常事实表要细长，行的增加速度也比维表快</p>
<blockquote>
<p>可加性事实是指可以按照与事实表关联的任意维度进行汇总<br>半可加性事实只能按照特定维度汇总，不能对所有维度汇总，如库存可以按照地点和商品进行汇总，对时间进行汇总则无意义<br>不可加性事实对所有维度都不能汇总，如比率型事实，不可加性事实可分解为可加的组件实现聚集</p>
</blockquote>
<h2 id="4-2-事实表设计原则"><a href="#4-2-事实表设计原则" class="headerlink" title="4.2 事实表设计原则"></a>4.2 事实表设计原则</h2><blockquote>
<p>尽可能包含所有与业务过程相关的事实，允许存在一定冗余<br>只选择与业务过程相关的事实，如订单的下单业务中，不应该存在支付金额<br>分解不可加性事实为可加的组件，如订单优惠率，应该分解为订单原价金额与订单优惠金额两个事实<br>在选择维度和事实之前必须先声明粒度，粒度用于确定事实表中一行所表示业务的细节层次，决定了维度模型的扩展性；且每个维度和事实必须与所定义的粒度保持一致<br>在同一个事实表中不能有多种不同粒度的事实，事实表中的所有事实需要与表定义的粒度保持一致<br>事实的单位要保持一致<br>对事实的 null 值要处理，建议用零值填充；数据库中常用的数字型字段的 SQL 过滤条件对 null 不生效<br>使用退化维度提高事实表的易用性，采用退化维度的方式，在事实表中存储各种类型的常用维度信息；通过增加冗余存储的方式减少计算开销，提高使用效率</p>
</blockquote>
<h2 id="4-3-事实表设计方法"><a href="#4-3-事实表设计方法" class="headerlink" title="4.3 事实表设计方法"></a>4.3 事实表设计方法</h2><ol>
<li><strong>选择业务过程及确定事实表类型</strong>：选择与需求有关的业务过程，根据具体的业务需求来选择与维度建模有关的业务过程</li>
<li><strong>声明粒度</strong>：决定事实表度量的细节层次，确保所有的事实按照同样的细节层次记录，应该尽量选择最细级别的原子粒度，以确保事实表的应用具有最大的灵活性</li>
<li><strong>确定维度</strong>：选择能够描述清楚业务过程所处的环境的维度信息，如淘宝订单付款事务事实表中，粒度为子订单，相关的维度有买家、卖家、商品、收货人信息 业务类型、订单时间等</li>
<li><strong>确定事实</strong>：选择与业务过程有关的所有事实，且事实的粒度要与所声明的事实表的粒度一致，如淘宝订单付款事务事实表中，同粒度的事实有子订单分摊的支付金额、邮费、优惠金额等</li>
<li><strong>冗余维度</strong>：通常事实表中会冗余方便下游用户使用的常用维度，以实现对事实表的过滤查询、控制聚合层次、排序数据以及定义主从关系等操作</li>
</ol>
<h2 id="4-4-事务事实表"><a href="#4-4-事务事实表" class="headerlink" title="4.4 事务事实表"></a>4.4 事务事实表</h2><p><strong>淘宝交易订单过程</strong>：重点介绍将多种商品加入到购物车中一起结算：对于每种商品都会产生一个订单 ，同时对于同一个店铺会额外产生一个父订单，父订单会承载订单物流、店铺优惠等信息；对于每一种商品产生的订单就称为子订单，子订单记录了父订单的订单号，并且有子订单标志；如果在同一个店铺只购买了一种商品，则会将父子订单进行合并 ，只保留一条订单记录</p>
<h3 id="4-4-1-设计过程"><a href="#4-4-1-设计过程" class="headerlink" title="4.4.1 设计过程"></a>4.4.1 设计过程</h3><ol>
<li><strong>选择业务过程</strong>：淘宝交易订单的流转过程包括四个重要过程：创建订单、买家付款、 卖家发货、买家确认收货，即下单、支付、发货和成功完结四个业务过程</li>
<li><strong>确定粒度</strong>：下单、支付和成功完结三个业务过程选择交易子订单粒度，即每个子订单为事务事实表的一行；每个子订单所表达的细节信息为： 交易时间、卖家、买家、商品；对于卖家发货确定为物流单粒度</li>
<li><strong>确定维度</strong>：按照经常用于统计分析的场景，确定维度包含：买家、卖家、商品、商品类目、发货地区、收货地区、父订单维度以及杂项维度；如订单的业务类型、是否无线交易、订单的 attributes 属性等使用较多却又无法归属维度的属性新建一个杂项维度进行存放</li>
<li><strong>确定事实</strong>：在下单业务过程中，包含下单金额、下单数量、下单分摊金额；在支付业务过程中，包含支付金额、分摊邮费、折扣金额、红包金额、积分金额；在完结业务过程中包含确认收货金额等；对于父订单的父订单邮费、父订单折扣需要分摊到子订单中</li>
<li><strong>冗余维度</strong>：将买卖家星级、标签、店铺名称、商品类型、商品特征、商品属性、类目层级等维度属性都冗余到事实表中；提高对事实表进行过滤查询、统计聚合的效率</li>
</ol>
<h3 id="4-4-2-单事务事实表"><a href="#4-4-2-单事务事实表" class="headerlink" title="4.4.2 单事务事实表"></a>4.4.2 单事务事实表</h3><p><strong>单事务事实表</strong>：针对每个业务过程设计一个事实表，可以方便地对每个业务过程进行独立的分析研究<br><strong>1688 交易</strong>：主要流程也是下单、支付、发货和完结，选择下单和支付两个业务过程设计事务事实表；对于1688 交易订单下单事务事实表，确定子订单粒度，选择买家、卖家、商品、父订单、收货地区维度，事实包含下单分摊金额和折扣金额；对于 1688 交易订单支付事务事实表 ，粒度和维度与交易订单下单事务事实表相同，所表达的事实则不一样 ，包含支付金额、支付调整金额和支付优惠等；当天数据进入当天的事实表中</p>
<h3 id="4-4-3-多事务事实表"><a href="#4-4-3-多事务事实表" class="headerlink" title="4.4.3 多事务事实表"></a>4.4.3 多事务事实表</h3><p><strong>多事务事实表</strong>：将不同的事实放到同 个事实表中，即同一个事实表包含不 同的业务过程</p>
<ul>
<li><strong>事实处理方式</strong></li>
</ul>
<blockquote>
<p>不同业务过程的事实使用不同的事实字段进行存放<br>不同业务过程的事实使用同一个事实字段进行存放，增加一个业务过程标签</p>
</blockquote>
<h4 id="4-4-3-1-实践"><a href="#4-4-3-1-实践" class="headerlink" title="4.4.3.1 实践"></a>4.4.3.1 实践</h4><p><strong>淘宝交易事务事实表</strong>：包含下单、支付和成功完结三个业务过程；拥有相同的子订单粒度，适合放到同一个事实表中；发货的粒度比子订单更细，需要单独一张事实表；常用维度一致，包括买家、卖家、商品、类目、店铺、收发货地区等，事实表中需要包含下单度量、支付度量和成功完结度量信息，针对每一个度量采用一个字段存储数据，其他数据使用零值填充；对业务过程添加标签字段进行标识<br><strong>淘宝收藏商品事务事实表</strong>：收藏业务包含收藏商品和删除商品两个业务过程，确定业务为用户加上商品粒度，使用“收藏事件类型”个字段区分存放是收藏商品还是删除商品，收藏事务事实表是无事实的事实表，一般用于统计收藏或者删除的次数<br><strong>多事务事实表的选择</strong>：</p>
<blockquote>
<p>当不同业务过程的度量比较相似、差异不大时，可采用类似<strong>淘宝收藏商品事务事实表</strong>的设计方式，使用同 个字段来表示 数据；在同一个周期内可能会存在多条记录<br>当不同业务过程的度量差异较大时，可采用类似<strong>淘宝交易事务事实表</strong>的设计方式，将不同业务过程的度量使用不同字段段冗余到表中，非当前业务过程则置零表示；度量字段零值较多</p>
</blockquote>
<h3 id="4-4-4-两种事实表对比"><a href="#4-4-4-两种事实表对比" class="headerlink" title="4.4.4 两种事实表对比"></a>4.4.4 两种事实表对比</h3><table>
<thead>
<tr>
<th></th>
<th><strong>单事务事实表</strong></th>
<th><strong>多事务事实表</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>业务过程</strong></td>
<td>一个</td>
<td>多个</td>
</tr>
<tr>
<td><strong>粒度</strong></td>
<td>相互之间不相关</td>
<td>相同粒度</td>
</tr>
<tr>
<td><strong>维度</strong></td>
<td>相互之间不相关</td>
<td>一致</td>
</tr>
<tr>
<td><strong>事实</strong></td>
<td>只取当前业务过程中的事实</td>
<td>保留多个业务过程的事实，非当前业务置零</td>
</tr>
<tr>
<td><strong>冗余维度</strong></td>
<td>多个业务过程，需要冗余多次</td>
<td>不同业务过程只需要冗余一次</td>
</tr>
<tr>
<td><strong>理解程度</strong></td>
<td>易于理解，不会混淆</td>
<td>难以理解，需要通过标签限定</td>
</tr>
<tr>
<td><strong>计算存储成本</strong></td>
<td>较高，每个业务过程都需要计算存储一次</td>
<td>较低，多个业务过程融合到一起降低了存储计算量，非当前业务存在大量零值</td>
</tr>
</tbody></table>
<h3 id="4-4-4-1-父子事实的处理方式"><a href="#4-4-4-1-父子事实的处理方式" class="headerlink" title="4.4.4.1 父子事实的处理方式"></a>4.4.4.1 父子事实的处理方式</h3><pre class="line-numbers language-none"><code class="language-none">子订单下单全额 ＝ 下单商品数量 × 商品价格
子订单分摊的有效下单全额 ＝ 下单商品数量 × 商品价格 ＋ 父订单邮费 × 下单分摊比例 - 子订单折扣 - 父订单折扣 × 下单分摊比例
下单分摊比例 ＝（下单商品数量 × 原价 - 子订单折扣）&#x2F; sum（下单商品数量 × 原价 - 子订单折扣）
子订单分摊的支付金额 ＝ 父订单支付金额 × 支付分摊比例
支付分摊比例 ＝ （下单商品数量 × 原价 - 子订单折扣 ＋ 调价）&#x2F; sum（下单商品数量 × 原价 - 子订单折扣 ＋ 调价）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-4-4-5-事实的设计准则"><a href="#4-4-4-5-事实的设计准则" class="headerlink" title="4.4.4.5 事实的设计准则"></a>4.4.4.5 事实的设计准则</h3><ol>
<li><strong>事实完整性</strong>：事实表包含与其描述的过程有关的所有事实，尽可能多地获取所有的度量</li>
<li><strong>事实一致性</strong>：确定事务事实表的事实时，明确存储每一个事实以确保度量的一致性</li>
<li><strong>事实可加性</strong>：将非可加性度量拆分转换为可加性度量</li>
</ol>
<h2 id="4-5-周期快照事实表"><a href="#4-5-周期快照事实表" class="headerlink" title="4.5 周期快照事实表"></a>4.5 周期快照事实表</h2><p><strong>周期快照事实表</strong>：简称“快照事实表”，在确定的间隔内对实体的度量进行抽样，表示当前状态度量，如账户余额、买卖家星级、商品库存、卖家累积交易额等</p>
<h3 id="4-5-1-特性"><a href="#4-5-1-特性" class="headerlink" title="4.5.1 特性"></a>4.5.1 特性</h3><ol>
<li><strong>用快照采样状态</strong>：以预定的间隔采样状态度量，间隔联合一个或多个维度，被用来定义快照事实表的粒度</li>
<li><strong>快照粒度</strong>：采样周期和采样内容组合成事实表粒度</li>
<li><strong>密度与稀疏性</strong>：事务事实表是稀疏的，只记录当天业务过程发生的事实；快照事实表是稠密的，无论当天是否有业务过程发生，都会记录一行</li>
<li><strong>半可加性</strong>：快照事实表收集到的状态度量都是半可加的，不能根据时间维度获得有意义的汇总结果</li>
</ol>
<h3 id="4-5-2-实践"><a href="#4-5-2-实践" class="headerlink" title="4.5.2 实践"></a>4.5.2 实践</h3><p><strong>单维度的每天快照事实表—淘宝卖家历史至今汇总事实表</strong>：</p>
<ol>
<li><strong>确定粒度</strong>：采样周期为每天，针对卖家、买家、商品、类目 、地区等维度建设快照事实表</li>
<li><strong>确定状态度量</strong>：针对粒度确定需要采样的状态度量，包含历史截至当日的下单金额、历史截止当日的支付金额等</li>
</ol>
<p><strong>混合维度的每天快照事实表—淘宝买卖家历史至今快照事实</strong>：</p>
<ol>
<li><strong>确定粒度</strong>：采样周期是每天，维度是卖家加买家</li>
<li><strong>确定状态度量</strong>：不同买家对于不同卖家的下单支付金额</li>
</ol>
<p><strong>全量快照事实表—淘宝好中差评快照事实表</strong></p>
<ol>
<li><strong>确定粒度</strong>：淘宝好中差评每天都在变化，下游统计分析也是每天都在进行；确定采样周期是每天；采样维度针对评价本身，每一条好中差评价就是快照事实表的最细粒度</li>
<li><strong>确定状态度量</strong>：对于好中差评价的度量关注更多的是评价本身，设计为无事实的事实表，更多关注评价的状态；冗余子订单维度、商品维度、评论者维度、被评论维度以及杂项维度 ，包括评论内容、是否匿名等信息</li>
</ol>
<h3 id="4-5-3-产出模式"><a href="#4-5-3-产出模式" class="headerlink" title="4.5.3 产出模式"></a>4.5.3 产出模式</h3><blockquote>
<p>从事务事实表进行汇总产出，如淘宝卖家历史至今汇总事实表、淘宝买卖家历史至今快照事实<br>直接使用操作型系统的数据作为周期快照事实表的数据源进行加工，如淘宝卖家星级、卖家 DSR （物流服务、描述相符和服务态度）事实表</p>
</blockquote>
<h3 id="4-5-4-注意事项"><a href="#4-5-4-注意事项" class="headerlink" title="4.5.4 注意事项"></a>4.5.4 注意事项</h3><ol>
<li><strong>事务与快照成对设计</strong>：事务事实表和快照事实表往往都是成对设计的 ，互相补充，以满足更 的下游统计分析需求，在事务事实表的基础上加工得到快照事实表</li>
<li><strong>附加事实</strong>：附加上一个采样周期的状态度量</li>
<li><strong>周期到日期度量</strong>：关注自然年至今、季度至今、财年至今的状态度量，如淘宝卖家财年至今的下单金额、淘宝商品自然年至今的收藏次数等</li>
</ol>
<h2 id="4-6-累积快照事实表"><a href="#4-6-累积快照事实表" class="headerlink" title="4.6 累积快照事实表"></a>4.6 累积快照事实表</h2><p><strong>累积快照事实表</strong>：研究事件之间时间间隔的需求，如统计买家下单到支付的时长、买家支付到卖家发货的 时长、买家从下单到确认收货的时长等</p>
<h3 id="4-6-1-设计过程"><a href="#4-6-1-设计过程" class="headerlink" title="4.6.1 设计过程"></a>4.6.1 设计过程</h3><ol>
<li><strong>选择业务过程</strong>：针对淘宝交易累积快照事实表，选择买家下单、买家支付、卖家发货、买家确认收货业务四个业务过程</li>
<li><strong>确定粒度</strong>：选择子订单粒度，累积快照事实表考察实体的唯一实例，子订只有一行记录，业务事件发生时，更新实例</li>
<li><strong>确定维度</strong>：维度主要有买家、卖家、店铺、商品、类目、发货地区、收货地区等，四个业务过程的时间字段，对应于日期维表；新建杂项维度存放订单类型、子类型、支付状态、物流状态、 attributes、options 等</li>
<li><strong>确定事实</strong>：将每个过程的时间间隔作为事实放在事实表中</li>
<li><strong>退化维度</strong>：提高下游用户的使用效率，降低数据获取的复杂性，减少关联的表数量</li>
</ol>
<h3 id="4-6-2-特点"><a href="#4-6-2-特点" class="headerlink" title="4.6.2 特点"></a>4.6.2 特点</h3><ol>
<li><strong>数据不断更新</strong>：累积快照事实表则对实体的某一实例定期更新业务发生时间</li>
<li><strong>多业务过程日期</strong>：累积快照事实表记录每一个实例从诞生到消亡等一系列过程的发生时间</li>
</ol>
<h3 id="4-6-3-特殊处理"><a href="#4-6-3-特殊处理" class="headerlink" title="4.6.3 特殊处理"></a>4.6.3 特殊处理</h3><ul>
<li><strong>非线性过程</strong>：并不是所有的交易都会按照正常交易流程（下单→支付→发货→确认收货）进行</li>
</ul>
<blockquote>
<p>下单→关闭订单：下单之后不支付，自己关闭订单或者经过一段时间后系统自动关闭订单<br>下单→支付→关闭订单：下单并支付之后，申请退款</p>
<blockquote>
<p>买家申请退款→卖家同意退款→退款达成<br>买家申请退款→卖家不同意退款→退款关闭<br>买家申请退款→卖家不同意退款→买家申请退款→卖家不同意退款→直到退款关闭</p>
</blockquote>
</blockquote>
<p><strong>处理情况</strong></p>
<blockquote>
<p>业务过程的统一：由交易完成作为结束标志变为交易完成和交易关闭作为结束标志<br>针对业务关键里程碑构建全面流程：将相关累积快照事实表的相关业务过程的时间字段和事实置空<br>循环流程的处理：基于商业用户进行里程碑日期的选择</p>
</blockquote>
<ul>
<li><strong>多源过程</strong>：业务过程可能来自于不同的系统或者来源于不同的表</li>
<li><strong>业务过程取舍</strong>：根据商业用户需求，选取关键业务的里程碑</li>
</ul>
<h3 id="4-6-4-物理实现"><a href="#4-6-4-物理实现" class="headerlink" title="4.6.4 物理实现"></a>4.6.4 物理实现</h3><ol>
<li><strong>全量表</strong>：一般为日期分区表，每天的分区存储昨天的全量数据和当天的增量数据合并的结果，保证每条记录的状态最新；适用于全量数据较少的情况</li>
<li><strong>全量表变形</strong>：每天的分区存储业务实体最大生命周期间隔的数据和当天的增量数据；如每天分区只存储最近100天的数据；用于存储事实表数据量较大的情况，数据量较大导致存储消耗较大</li>
<li><strong>以业务实体的结束时间分区</strong>：每天的分区存放当天结束的数据，设计一个时间非常大的分区，如 3000-12-31 ，存放截至当前未结束的数据，可能存在业务系统无法标识业务实体的结束时间</li>
</ol>
<blockquote>
<p>使用相 关业务系统的业务实体的结束标志作为此业务系统的结束标志；如针对物流订单，可以使用交易订单（理论上交易订单完结，则物流订单完结）<br>和前端业务系统确定口径或使用前端归档策略</p>
</blockquote>
<h2 id="4-7-三种事实表的比较"><a href="#4-7-三种事实表的比较" class="headerlink" title="4.7 三种事实表的比较"></a>4.7 三种事实表的比较</h2><table>
<thead>
<tr>
<th></th>
<th><strong>事务事实表</strong></th>
<th><strong>周期快照事实表</strong></th>
<th><strong>累积快照事实表</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>时期/时间</strong></td>
<td>离散事务时间点</td>
<td>以有规律的、可预测的间隔产生快照</td>
<td>用于时间跨度不确定的不断变化的工作流</td>
</tr>
<tr>
<td><strong>日期维度</strong></td>
<td>事务日期</td>
<td>快照日期</td>
<td>相关业务过程涉及的多个日期</td>
</tr>
<tr>
<td><strong>粒度</strong></td>
<td>每行代表实体一个事务</td>
<td>每行代表某时间周期的一个实体</td>
<td>每行代表一个实体的生命周期</td>
</tr>
<tr>
<td><strong>事实</strong></td>
<td>事务事实</td>
<td>累积事实</td>
<td>相关业务过程事实和时间间隔事务</td>
</tr>
<tr>
<td><strong>事实表加载</strong></td>
<td>插入</td>
<td>插入</td>
<td>捅入与更新</td>
</tr>
<tr>
<td><strong>事实表更新</strong></td>
<td>不更新</td>
<td>不更新</td>
<td>业务过程变更时更新</td>
</tr>
</tbody></table>
<p>事务事实表记录的事务层面的事实，用于跟踪业务过程的行为,支持几种描述行为的事实，保存的是最原子的数据，也称为“原子事实表”<br>周期快照事实表以具有规律性的、可预见的时间间隔来记录事实，如余额、库存、层级、温度等，时间间隔为每天、每月、每年等，如库存日快照表等<br>累积快照事实表被用来跟踪实体的一系列业务过程的进展情况，通常具有多 个日期字段，用于研究业务过程中的里程碑过程的时间间隔</p>
<h2 id="4-8-无事实的事实表"><a href="#4-8-无事实的事实表" class="headerlink" title="4.8 无事实的事实表"></a>4.8 无事实的事实表</h2><p><strong>无事实的事实表</strong>：不包含事实或度量的事实表，用来支持业务过程的度量</p>
<blockquote>
<p>事件类的，记录事件的发生；如用户的浏览日志：某会员某时间点浏览了淘宝首页、某卖家的店铺中的某商品详情页等<br>条件、范围或资格类的，记录维度与维度多对多之 间的关系；如客户和销售人员的分配情况、产品的促销范围等</p>
</blockquote>
<h2 id="4-9-聚集型事实表"><a href="#4-9-聚集型事实表" class="headerlink" title="4.9 聚集型事实表"></a>4.9 聚集型事实表</h2><p><strong>聚集型事实表</strong>：聚集是指针对原始明细粒度的数据进行汇总；阿里巴巴将使用频繁的公用数据，通过聚集进行沉淀，形成公共汇总层”</p>
<ul>
<li><strong>聚集的基本原则</strong></li>
</ul>
<blockquote>
<p><strong>一致性</strong>：聚集表必须提供与查询明细粒度数据 致的查询结果<br><strong>避免单一表设计</strong>：不要在同一个表中存储不同层次的聚集数据，可以通过显式加人数据层级列以示区别<br><strong>聚集粒度可不同</strong>：聚集并不需要保持与原始明细粒度数据一样的粒度，只聚集关心查询的维度</p>
</blockquote>
<h3 id="4-9-1-聚集的基本步骤"><a href="#4-9-1-聚集的基本步骤" class="headerlink" title="4.9.1 聚集的基本步骤"></a>4.9.1 聚集的基本步骤</h3><ol>
<li><strong>确定聚集维度</strong>：根据用户关心的维度聚集数据</li>
<li><strong>确定一致性上钻</strong>：根据用户需求确定上钻维度，如按月汇总或按天汇总，按商品汇总或按类目汇总</li>
<li><strong>确定聚集事实</strong>：根据用户需求明确聚集的事实数据，如按照交易额汇总还是按照成交数量汇总</li>
</ol>
<h3 id="4-9-2-阿里公共汇总层"><a href="#4-9-2-阿里公共汇总层" class="headerlink" title="4.9.2 阿里公共汇总层"></a>4.9.2 阿里公共汇总层</h3><ul>
<li><strong>聚集基本原则</strong>：应遵守聚集的基本原则，还有个性化的原则</li>
</ul>
<blockquote>
<p><strong>数据公用性</strong>：聚集经常用于数据分析中或有第三者使用的基于某个维度<br><strong>不跨数据域</strong><br><strong>区分统计周期</strong>：在表的命名上要能说明数据的统计周期</p>
</blockquote>
<ul>
<li><strong>交易汇总表设计</strong>：淘宝交易事务事实表</li>
</ul>
<ol>
<li>按商品粒度汇总</li>
</ol>
<blockquote>
<p>确定聚集维度—卖家<br>确定一致性上钻一按卖家最近 天和最近 30 天汇总<br>确定聚集事实一交易额</p>
</blockquote>
<ol start="2">
<li>按卖家、买家、商品粒度汇总</li>
</ol>
<blockquote>
<p>确定聚集维度一卖家、买家、商品<br>确定一致性上钻一按卖家、买家、商品）最近1天汇总<br>确定聚集事实一交易额</p>
</blockquote>
<ol start="3">
<li>按二级类目汇总</li>
</ol>
<blockquote>
<p>确定聚集维度一类目<br>确定一致性上钻一按最近1天类目维度的二级维度属性汇总<br>确定聚集事实一交易额</p>
</blockquote>
<h3 id="4-9-3-聚集补充说明"><a href="#4-9-3-聚集补充说明" class="headerlink" title="4.9.3 聚集补充说明"></a>4.9.3 聚集补充说明</h3><ol>
<li><strong>聚集是不跨越事实的</strong>：聚集是针对原始星形模型进行的汇总，聚集的维度和度量与原始模型保持一致，获取和查询与原始模型一致的结果</li>
<li><strong>聚集带来的问题</strong>：聚集会带来查询性能的提升，也会增加 ETL 的维护难度</li>
</ol>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">戚中一</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://qizhongyi.gitee.io/202109/0227125.html">https://qizhongyi.gitee.io/202109/0227125.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">戚中一</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">
                                    <span class="chip bg-color">大数据</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">熬夜撸码，来杯咖啡！</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/202109/0256600.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/17.jpg" class="responsive-img" alt="大数据实践-01阿里-数据管理">
                        
                        <span class="card-title">大数据实践-01阿里-数据管理</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            写在前面：本文主要记录大数据实践-01阿里-数据管理的相关内容
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-09-02
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%AE%9E%E8%B7%B5/" class="post-category">
                                    实践
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">
                        <span class="chip bg-color">大数据</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/202109/0125760.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="大数据实践-01阿里-数据技术">
                        
                        <span class="card-title">大数据实践-01阿里-数据技术</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            写在前面：本文主要记录大数据实践-01阿里-数据技术的相关内容
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-09-01
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%AE%9E%E8%B7%B5/" class="post-category">
                                    实践
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">
                        <span class="chip bg-color">大数据</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 戚中一<br />'
            + '文章作者: 戚中一<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('10'),
            headingSelector: 'h1, h2, h3, h4, h5'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2022</span>
            
            <a href="/about" target="_blank">戚中一</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">265.8k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/qizhongyizhang" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:18371879651@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>');
            }
        </script>
    

    <!-- 鼠标星星特效 -->
    

    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
